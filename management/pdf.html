
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Tracks</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style type="text/css">
        /*#the-canvas{ margin-left: 15%; width: 70%; }*/
        #fixed{ position: fixed; top: 20%; right: 1%; }
        #fixed button{ display: block; width: 70px; }
    </style>
</head>
<script src="http://mozilla.github.io/pdf.js/build/pdf.js"></script>
<body>
   
    <div id="fixed">
      <button id="prev">上一页</button>
      <button onclick="one(1)">1</button>
      <button onclick="one(2)">2</button>
      <button onclick="one(3)">3</button>
      <button onclick="one(4)">4</button>
      <button onclick="one(5)">5</button>
      <button onclick="one(6)">6</button>
      <input type="number" style="width: 70px;" onblur="int(this)"  >
      <button id="next">下一页</button>
      
      &nbsp; &nbsp;
      <span>页数: <span id="page_num"></span> / <span id="page_count"></span></span>
    </div>

    <canvas id="the-canvas"></canvas>
</body>
<script type="text/javascript">

    //如果从远程服务器提供了绝对路径,配置CORS
    // header on that server.http://localhost/pm.pdf
    var url = './mm.pdf';  

    //加载通过<脚本>标记,创建快捷方式来访问PDF。js出口。
    var pdfjsLib = window['pdfjs-dist/build/pdf'];

    // workerSrc 指定路径.
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'http://mozilla.github.io/pdf.js/build/pdf.worker.js';

    var pdfDoc = null,
        pageNum = 1,
        pageRendering = false,
        pageNumPending = null,
        scale = 1.5,
        canvas = document.getElementById('the-canvas'),
        ctx = canvas.getContext('2d');

    /**
     *从文档获取页面信息,调整相应的画布,并呈现页面。
     * @param num 页码.
     */
    function renderPage(num) {
          pageRendering = true;
          //通过promise获取页码
          pdfDoc.getPage(num).then(function(page) {
            var viewport = page.getViewport(scale);
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            // 呈现PDF页面到画布背景
            var renderContext = {
              canvasContext: ctx,
              viewport: viewport
            };
            var renderTask = page.render(renderContext);

            // 等待渲染完成
            renderTask.promise.then(function() {
              pageRendering = false;
              if (pageNumPending !== null) {
                //新页面呈现
                renderPage(pageNumPending);
                pageNumPending = null;
              }
            });
          });

          //  更新页面计数
          document.getElementById('page_num').textContent = num;
    }

    /**
     * 
     如果另一个页面呈现过程中,等到呈现终结。否则,执行立即呈现
     */
    function queueRenderPage(num) {
      if (pageRendering) {
        pageNumPending = num;
      } else {
        renderPage(num);
      }
    }

    /**
     * 上一页
     */
    function onPrevPage() {
      if (pageNum <= 1) {
        return;
      }
      pageNum--;
      queueRenderPage(pageNum);
    }
    //具体页数
    function one(num) {
        pageNum = num;
        queueRenderPage(num);
    }
    //输入框页数
    function int(_this) {
        pageNum = parseInt(_this.value);
        queueRenderPage(pageNum);
        console.log(typeof pageNum);
    }

    //点击执行上一页
    document.getElementById('prev').addEventListener('click', onPrevPage);

    /**
     * 下一页
     */
    function onNextPage() {
      if (pageNum >= pdfDoc.numPages) {
        return;
      }
      pageNum++;
      queueRenderPage(pageNum);
    }
    //点击执行下一页
    document.getElementById('next').addEventListener('click', onNextPage);

    /**
     * 
        异步下载pdf
     */
    pdfjsLib.getDocument(url).then(function(pdfDoc_) {
      pdfDoc = pdfDoc_;
      document.getElementById('page_count').textContent = pdfDoc.numPages;

      // 
      //显示第一页
      renderPage(pageNum);
    });
</script>

</html>
